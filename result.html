<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Class-wise Student Analysis</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #74ebd5, #ACB6E5);
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 95%;
    max-width: 800px;
    margin-bottom: 15px;
    color: #fff;
  }
  header img {
    height: 50px;
    border-radius: 8px;
  }
  header h1 {
    font-size: 20px;
    text-align: center;
    margin: 0;
  }
  .chart-box {
    width: 95%;
    max-width: 800px;
    background: rgba(255, 255, 255, 0.95);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<header>
  <img src="school_logo.png" alt="School Logo">
  <h1>Class-wise Student Analysis</h1>
  <img src="pakistan_flag.png" alt="Flag">
</header>

<div class="chart-box">
  <h2>Students Scoring 30</h2>
  <div id="score30Chart" style="height: 250px;"></div>
</div>

<div class="chart-box">
  <h2>Class-wise Attempts</h2>
  <canvas id="attemptChart" height="200"></canvas>
</div>

<script>
  const rows = [
    ["Uzair-ud-Din",10,30], ["Emaan Fatima",8,30], ["M. Shahzain",6,30], ["Zainab Abdullah",6,30],
    ["Ajwa zahra",6,30], ["Tehreem Iqbal",9,30], ["Zainab Abdul Qadir",9,30], ["Naksh",6,30],
    ["Muhammad Nabeel",6,30], ["Hassaninrada",10,30], ["Mohammed bin Munazzam",9,30], ["Abdullah Masood",8,30],
    ["Hasnain",8,30], ["Barqa",9,30], ["Hassan Farhan",9,30], ["Hamza",8,30], ["Alisha ashok",8,30],
    ["Maryam moeen",7,30], ["M.abban khan",9,30], ["Abdul Rafay Kashif",6,30], ["Sudais irshad",9,30],
    ["Vedika Kumari",9,30], ["Adina farhat",6,30]
  ];

  // ===== Students scoring 30 =====
  const byClass30 = {};
  rows.filter(r => r[2] === 30).forEach(([name, cls]) => {
    if (!byClass30[cls]) byClass30[cls] = [];
    byClass30[cls].push(name);
  });

  const x = [], y = [], hoverText = [];
  Object.keys(byClass30).sort((a,b)=>a-b).forEach(cls=>{
    x.push("Class " + cls);
    y.push(byClass30[cls].length);
    hoverText.push(byClass30[cls].join("<br>"));
  });

  Plotly.newPlot("score30Chart", [{
    type:"bar",
    x, y,
    marker:{color:"#66B2FF"},
    text:y.map(String),
    textposition:"outside",
    hoverinfo:"text",
    hovertext:hoverText
  }], {
    margin:{t:30,l:40,r:20,b:40},
    yaxis:{title:"Students", rangemode:"tozero"},
    xaxis:{title:"Class"}
  }, {responsive:true});

  // Make bars clickable (Score 30 chart)
  document.getElementById('score30Chart').on('plotly_click', function(data){
    const idx = data.points[0].pointIndex;
    alert(`${x[idx]}:\n${byClass30[parseInt(x[idx].replace("Class ",""))].join("\n")}`);
  });

  // ===== Class-wise attempts =====
  const attemptData = [
    { name: "Attiq", class: 7, score: 18 }, { name: "Ghania Ali", class: 7, score: 15 },
    { name: "Muhammad hassan", class: 7, score: 24 }, { name: "Ikrash aslam", class: 7, score: 19 },
    { name: "Lubna", class: 8, score: 26 }, { name: "Uzair-ud-Din", class: 10, score: 30 },
    { name: "Ajwa zahra", class: 6, score: 29 }, { name: "Tehreem Iqbal", class: 9, score: 30 },
    { name: "Maryam moeen", class: 7, score: 30 }, { name: "Hassaninrada", class: 10, score: 30 }
  ];

  const byClassAttempt = {};
  attemptData.forEach(({name, class:cls}) => {
    if (!byClassAttempt[cls]) byClassAttempt[cls] = [];
    byClassAttempt[cls].push(name);
  });

  const labels = Object.keys(byClassAttempt).sort((a,b)=>a-b);
  const counts = labels.map(cls => byClassAttempt[cls].length);

  const ctx = document.getElementById("attemptChart").getContext("2d");
  const attemptChart = new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels.map(l=>"Class "+l),
      datasets:[{
        label:"Student Attempts",
        data: counts,
        backgroundColor: "#FF9999",
        borderColor:"#333",
        borderWidth:1
      }]
    },
    options: {
      responsive:true,
      plugins: {
        legend:{ display:false },
        tooltip: {
          callbacks: {
            label: (tooltipItem) => {
              const cls = parseInt(labels[tooltipItem.dataIndex]);
              return byClassAttempt[cls].join(", ");
            }
          }
        },
        title: { display: false }
      },
      onClick: (e, elements) => {
        if (elements.length > 0) {
          const idx = elements[0].index;
          const cls = parseInt(labels[idx]);
          alert(`Class ${cls}:\n${byClassAttempt[cls].join("\n")}`);
        }
      },
      scales: { y: { beginAtZero:true } }
    }
  });
</script>
</body>
</html>

